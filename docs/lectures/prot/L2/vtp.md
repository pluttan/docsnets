# VTP

**VTP** (*VLAN Trunking Protocol*) — это проприетарный протокол Cisco, используемый для управления и распространения информации о VLAN (виртуальных локальных сетях) в коммутаторной сети. Протокол облегчает управление VLAN, особенно в больших сетях, где используются множество коммутаторов.

## Основные функции VTP:

1. **Обмен информацией о VLAN**:  
   VTP позволяет централизованно управлять VLAN на одном коммутаторе и автоматически распространять эту информацию на другие коммутаторы в той же VTP-домене.  
   Например, добавление новой VLAN на главном коммутаторе автоматически добавит её на всех остальных коммутаторах.

2. **Централизованное управление**:  
   Вся информация о VLAN хранится в виде базы данных VLAN (VLAN Database). Эта база передается по сети на основе сообщений VTP.

## Режимы работы VTP

При настройке VTP коммутаторы(свичи) могут выступать в разных режимах работы.

**1. Server (Сервер):**
   - По умолчанию, все коммутаторы работают в этом режиме.
   - Коммутатор может:
     - Создавать, изменять и удалять VLAN.
     - Распространять обновления VTP в пределах домена.
   - Изменения, внесённые на сервере, передаются на все другие коммутаторы VTP-домена.

**2. Client (Клиент):**
   - Клиент не может добавлять, изменять или удалять VLAN.
   - Получает информацию о VLAN с коммутаторов в режиме **Server**.
   - Автоматически применяет обновления от сервера.

**3. Transparent (Прозрачный):**
   - Коммутатор не распространяет информацию о VLAN.
   - Не обрабатывает VTP-обновления, но пересылает их дальше.
   - VLAN, настроенные локально, действуют только на самом коммутаторе.

**4. Off (Выключен):**
   - Полностью отключает VTP.
   - Коммутатор не участвует в обмене информацией о VLAN, но может работать с локально настроенными VLAN.

## Компоненты VTP

1. **VTP-домен**:  
   Логическая группа коммутаторов, которая управляется одной базой данных VLAN. Все коммутаторы в домене используют одно и то же имя домена VTP.

2. **VTP-версии**:  
   - **VTPv1 и VTPv2**: Поддерживают 1–1005 VLAN. VTPv2 добавляет поддержку Token Ring VLAN.  
   - **VTPv3**: Расширяет возможности, добавляет поддержку расширенных VLAN (1006–4094) и улучшает безопасность.

3. **VTP-пароль**:  
   Используется для аутентификации коммутаторов, чтобы только устройства с одинаковым паролем могли участвовать в домене.

4. **VTP-номер ревизии**:  
   Это номер версии конфигурации VLAN. Если номер на сервере больше, чем на клиенте, то клиент применяет обновления. Если номер меньше, клиент игнорирует обновления.

5. **VTP-объявления (Advertisements):**  
   Информация о VLAN передается с использованием трех типов сообщений:
   - **Summary Advertisements**: Общая информация о VLAN и текущем состоянии базы данных.
   - **Subset Advertisements**: Детальная информация о VLAN.
   - **Advertisement Requests**: Запросы информации от клиента к серверу.

## Ограничения VTP

1. **Опасность удаления VLAN**:  
   Если сервер с более высокой версией ревизии случайно подключается к сети, он может удалить все существующие VLAN.

2. **Требует настройки транков**:  
   VTP работает только на транковых портах, которые поддерживают протоколы 802.1Q или ISL. Это может стать проблемой при подключении коммутатора непосредственно к компьютеру. Так как коммутатор устройство канального уровня оно ничего не знает о протоколе IPv4 и соответственно не может по IP адресу компьютера (по его части с алресом сети) определить в каком VLAN компьютер действительно находится (навесить VLAN тег протокола IEEE 802.1Q).

## Как VTP обрабатывает обновления:

1. **Создание новой VLAN** на сервере:  
   - Сервер увеличивает номер ревизии.
   - Распространяет информацию по всей сети.

2. **Получение обновления клиентом**:  
   - Если номер ревизии выше, клиент принимает изменения и обновляет свою базу данных VLAN.
   - Если номер ревизии ниже, обновление игнорируется.
