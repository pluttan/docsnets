import PDU from '../../../../static/lib/pdu'
import Mermaid from '../../../../static/lib/Mermaid'
import IframeComponent from '../../../../static/lib/iframe'

# FTP

**FTP** (*File Transfer Protocol*) — это стандартный сетевой протокол для передачи файлов между компьютерами в сети. Он был разработан для передачи файлов из одного устройства в другое через TCP/IP-сети (такие как интернет или локальные сети). Работает по TCP, для работы необходимо 2 TCP соединения (по разным портам).

![](../../imgs/ftpConnection.drawio.svg)

**PI** (*protocol interpretator*) - интерфейс общения между клиентом и сервером, предназначен для обмена коммандами. Открывается один раз за сессию и закрывается только при ее окончании.

**DTP** (*data transfer process*) - соединение для передачи файлов и данных. Открывается каждый раз когда необходимо передать данные.

1. **Порты**:
   - **Порт 21**: Управляющее соединение (для передачи команд).
   - **Порт 20**: Данные передаются через этот порт (в активном режиме).

2. **Аутентификация**:
   - Поддерживаются два варианта:
     - **Анонимный доступ**: Пользователи могут подключаться без регистрации (используя логин `anonymous`).
     - **Авторизованный доступ**: Требуется ввод логина и пароля.

3. **Режимы передачи файлов**:
   - **ASCII**: Для текстовых файлов.
   - **Binary**: Для двоичных файлов (изображений, видео, архивов и т. д.), чтобы избежать повреждения данных.


### **Типы соединений FTP**
1. **Активный режим (Active Mode)**:
   - Сервер устанавливает соединение с клиентом через порт 20 для передачи данных.
   - Может быть проблемой за NAT или брандмауэром, поскольку сервер инициирует обратное соединение.

2. **Пассивный режим (Passive Mode)**:
   - Клиент инициирует как управляющее, так и соединение для передачи данных.
   - Используется чаще, так как решает проблемы с NAT и брандмауэрами.


## Основные FTP-команды

#### **Аутентификация и управление сеансом**
- `USER <username>`: Указывает имя пользователя для аутентификации.
- `PASS <password>`: Указывает пароль для пользователя.
- `QUIT`: Завершает сеанс и разрывает соединение с сервером.
- `REIN`: Откат к заводским настойкам, применяется с задержкой.
- `HELP [command]`: Показывает справку по указанной команде (или общий список команд, если команда не указана).

#### **Навигация по каталогам**
- `PWD`: Показывает текущий рабочий каталог на сервере.
- `CWD <path>`: Меняет текущий рабочий каталог.
- `CDUP`: Переходит на один уровень вверх в иерархии каталогов.

#### **Управление файлами и каталогами**
- `LIST [path]`: Отображает список файлов и каталогов (аналог `ls` в Unix).
- `NLST [path]`: Отображает только имена файлов и каталогов (без подробной информации).
- `MKD <directory>`: Создает новый каталог.
- `RMD <directory>`: Удаляет каталог.
- `DELE <filename>`: Удаляет файл.
- `RNFR <filename>`: Указывает исходное имя файла для переименования. После этой комманды обязательна комманда `RNTO`.
- `RNTO <filename>`: Указывает новое имя для файла.

#### **Передача файлов**
- `RETR <filename>`: Скачивает файл с сервера.
- `STOR <filename>`: Загружает файл на сервер.
- `STOU`: Загружает файл на сервер с уникальным именем.
- `APPE <filename>`: Добавляет данные к существующему файлу на сервере.

#### **Управление режимами передачи**
- `TYPE <type>`: Устанавливает режим передачи данных.
  - `TYPE A`: Текстовый (ASCII) режим.
  - `TYPE I`: Двоичный (binary) режим.
- `MODE <mode>`: Устанавливает режим передачи (обычно `STREAM`).
- `STRU <structure>`: Указывает структуру файла (обычно `FILE`).

#### **Управление соединением**
- `PORT <address>`: Указывает адрес клиента для активного соединения.
- `PASV`: Переводит сервер в пассивный режим. Сервер отвечает `h1, h2, h3, h4, p1, p2`: h - октеты IP, p - номер порта (p1*256+p2)
- `ABOR`: Прерывает текущую передачу данных.
- `NOOP`: Проверяет активность соединения, отправляя пустую команду.

#### **Информация о сервере**
- `SYST`: Возвращает информацию о типе системы сервера.
- `STAT [path]`: Показывает текущую информацию о соединении или указанном пути.
- `FEAT`: Показывает список поддерживаемых сервером расширений.
- `SIZE <filename>`: Возвращает размер файла.
- `MDTM <filename>`: Возвращает дату и время последнего изменения файла.

