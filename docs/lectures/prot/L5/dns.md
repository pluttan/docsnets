import PDU from '../../../../static/lib/pdu'
import Mermaid from '../../../../static/lib/Mermaid'
import IframeComponent from '../../../../static/lib/iframe'

# DNS

**DNS** (*Domain Name System*) — это компонент, который отвечает за преобразование доменных имен (например, `example.com`) в IP-адреса (например, `93.184.216.34`), необходимые для соединения с серверами. DNS работает как телефонная книга интернета, упрощая взаимодействие пользователей с сетью. Работает по UDP на 53 порту.


## Доменные имена
Доменное имя - удобочитаемый пользователем адрес, такие как `google.com`. 

Они разбиваются на иерархические уровни:
   - **TLD (Top-Level Domain)** (домен 1 уровня): Верхний уровень домена (например, `.com`, `.org`, `.ru`).
   - **Second-Level Domain** (домен 2 уровня): Основное имя сайта (например, `google` в `google.com`).
   - **Subdomain** (домен 3 уровня): Поддомены, такие как `mail.google.com`.

![](../../imgs/dnsTree.drawio.svg)

В корне изначально находилось 13 серверов: A, B, C, ... Они знали, где расположены DNS сервера 1 уровня (например, `.com`, `.org`, `.ru`). Сейчас были добавлены еще сервера, которые являются зеркалами этих 13.

Сервера 1 уровня выдаются для:
- Каждой страны
- Каждого вида организации

У такого распределения имен есть множество плюсов:

- Распределенность
- Независимость администрирования
- Резервирование за счет зеркал

## Как сервера работают между собой?
### Не рекурсивная форма
При нерекурсивной форме компьютер ходит по всем DNS серверам сам:
![](../../imgs/dnsNoRec.drawio.svg)

1. Обращаемся к DNS серверу провайдера и спрашиваем его на счет `iu6.bmstu.ru`
2. Сервер отвечает: я не знаю, но знаю того, кто знает и отправляет нас в корень.
3. Обращаемся к DNS серверу корня и спрашиваем его на счет `iu6.bmstu.ru`
4. Корень видит домен `ru` и отправляет нас на сервер `ru` 
5. Обращаемся к DNS серверу `ru` и спрашиваем его на счет `iu6.bmstu.ru`
6. Сервер `ru` видит `bmstu` и отправляет на сервер `bmstu`
7. Обращаемся к DNS серверу `bmstu` и спрашиваем его на счет `iu6.bmstu.ru`
8. Сервер `bmstu` видит `iu6` и отправляет ip сервера `iu6.bmstu.ru`

### Рекурсивная форма
![](../../imgs/dnsRec.drawio.svg)

1. Обращаемся к DNS серверу провайдера и спрашиваем его на счет `iu6.bmstu.ru`
2. Сервер знает адрес корня и спрашивает его на счет `iu6.bmstu.ru`.
3. Корень видит домен `ru` и обращается на сервер `ru` с запоросом `iu6.bmstu.ru`
4. Сервер `ru` видит `bmstu` и обращается на сервер `bmstu` с запоросом `iu6.bmstu.ru`
5. Сервер `bmstu` видит `iu6` и отправляет ip сервера `iu6.bmstu.ru` серверу `ru`
6. Сервер `ru` пересылает полученный ip корню
7. Корень пересылает полученный ip провайдеру
8. Провайдер передает компьтеру
   

В реальной жизни оба подхода комбинируют: рекурсивный идет до провайдера, а потом сервер провайдера проходит через все нерекурсивным методом и возвращает нам искомый ip.



## Рекорды DNS

DNS хранит различные типы записей, которые определяют, как домен обрабатывается. Основные из них:
- **A (Address Record)**: Сопоставляет домен с IPv4-адресом.
- **AAAA**: Сопоставляет домен с IPv6-адресом.
- **CNAME (Canonical Name)**: Перенаправляет с одного домена на другой.
- **MX (Mail Exchange)**: Указывает почтовый сервер для домена.
- **TXT**: Содержит произвольный текст или данные (например, для валидации).
- **NS (Name Server)**: Указывает, какие серверы управляют DNS-записями домена.
- **PTR (Pointer Record)**: Используется для обратного разрешения IP-адресов в доменные имена.

## Запись в DNS-caсhe

<PDU maxCellSize={6} name={'Запись в DNS-caсhe'} data={[
    { 
        size: 1, 
        name: "Name",
        desc: "Доменное имя"
    },
    { 
        size: 1, 
        name: "TTL",
        desc: "Time to life"
    },
    { 
        size: 1, 
        name: "Type",
        desc: "DNS Record"
    },
    { 
        size: 1, 
        name: "Class",
        desc: "TCP/IP"
    },
    { 
        size: 1, 
        name: "RDLen",
        desc: "R - ресурсы, D - данные"
    },
    { 
        size: 1, 
        name: "RData",
        desc: "Ресурсы данных"
    },
]} />
