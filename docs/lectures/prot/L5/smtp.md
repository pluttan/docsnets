import PDU from '../../../../static/lib/pdu'
import Mermaid from '../../../../static/lib/Mermaid'
import IframeComponent from '../../../../static/lib/iframe'

# SMTP

**SMTP** (*Simple Mail Transfer Protocol*) — это стандартный протокол для отправки электронной почты через интернет. Он был разработан для обеспечения надежной передачи сообщений от отправителя к получателю через почтовые серверы. SMTP используется исключительно для отправки писем, в то время как для их получения применяются другие протоколы, такие как **IMAP** или **POP3**.

## Порты SMTP
SMTP использует следующие порты:
1. **25**: Стандартный порт для обмена между серверами. Часто блокируется провайдерами для предотвращения спама.
2. **587**: Используется для отправки писем с аутентификацией (рекомендуемый порт для клиентов).
3. **465**: Используется для зашифрованных соединений через SSL/TLS.

## Основные функции SMTP
1. **Отправка писем**:
   - Используется для отправки сообщений от клиента (почтовой программы) к почтовому серверу.
   
2. **Ретрансляция писем**:
   - Передает сообщения от одного почтового сервера к другому до достижения конечного сервера получателя.

3. **Доставка писем локальным пользователям**:
   - Отправляет сообщения пользователям, обслуживаемым на том же сервере.

## Как работает SMTP
SMTP работает в модели клиент-сервер, где почтовый клиент (например, Outlook, Gmail или Thunderbird) соединяется с почтовым сервером для отправки сообщений. Основные этапы:

1. **Установление соединения**:
   - Клиент устанавливает TCP-соединение с SMTP-сервером через порт (обычно **25**, **587**, или **465** для шифрованных соединений).

2. **HELO/EHLO**:
   - Инициализация соединения.
   - `HELO` — устаревший вариант.
   - `EHLO` — расширенный протокол с поддержкой шифрования и других функций.
  
3. Аутендификация(необязательно):
   - Комманда `AUTH` используется для аутентификации (например, логин и пароль).

4. **Передача сообщения**:
   - Клиент и сервер обмениваются командами и ответами, используя текстовые команды SMTP.
   - `MAIL FROM`: Указывает отправителя письма.
   - `RCPT TO`: Указывает одного или нескольких получателей.
   - `DATA`: Указывает начало тела сообщения (заголовки + текст письма). Завершается строкой `\n.\n`.


5. **Закрытие соединения**:
   - После успешной передачи сервер подтверждает прием, и соединение закрывается (комманда `QUIT`).

## Коды ответа сервера SMTP

Коды ответа SMTP показывают, как сервер реагирует на команды, отправленные клиентом. Они состоят из трех цифр, где:

1. **Первая цифра** указывает общий статус:
   - `2xx` — Успешное выполнение.
   - `3xx` — Дополнительное действие клиента.
   - `4xx` — Временная ошибка (попробуйте позже).
   - `5xx` — Постоянная ошибка (повтор не поможет).

2. **Вторая цифра** описывает источник ошибки:
   - `x0x` — Синтаксис.
   - `x1x` — Информация.
   - `x2x` — Канал соединения.
   - `x3x` — Не используется.
   - `x4x` — Почтовая система.
   - `x5x` — Содержимое сообщения или состояние получателя.

3. **Третья цифра** уточняет статус.


### Коды успешного выполнения (2xx)

- **211**: Статус системы или справка.
- **214**: Сообщение справки (информация о сервере).
- **220**: Готов к выполнению — новый сеанс.
- **221**: Завершение соединения.
- **235**: Аутентификация выполнена успешно.
- **250**: Команда успешно выполнена.
- **251**: Почтовый адрес будет переслан (неконечный получатель).

### Коды дополнительного действия клиента (3xx)

- **334**: Запрос данных аутентификации (логин или пароль).
- **354**: Ожидание ввода данных сообщения (после команды `DATA`).

### Коды временных ошибок (4xx)

- **421**: Служба недоступна (перегрузка или временная проблема).
- **450**: Почтовый ящик временно недоступен (например, занят или переполнен).
- **451**: Запрос не выполнен из-за ошибки обработки (например, недостаточно ресурсов).
- **452**: Недостаточно места для обработки команды.

### Коды постоянных ошибок (5xx)

- **500**: Ошибка синтаксиса — команда не распознана.
- **501**: Ошибка аргументов или параметров команды.
- **502**: Команда не реализована.
- **503**: Последовательность команд нарушена (например, `MAIL` перед `RCPT`).
- **504**: Параметр команды не реализован.
- **550**: Почтовый ящик недоступен (например, не существует или запрещен доступ).
- **551**: Пользователь не обслуживается этим сервером.
- **552**: Превышен лимит места на сервере для сообщения.
- **553**: Неверный адрес получателя.
- **554**: Передача сообщения запрещена (например, письмо отклонено как спам).

### Часто используемые коды на практике
- **250 OK**: Указывает, что сервер успешно выполнил команду.
- **354 Start mail input**: Означает, что сервер ожидает ввода тела письма (заканчивается строкой `.`).
- **550 Requested action not taken**: Получатель недоступен или адрес некорректен.
- **421 Service not available**: Сервер временно недоступен.


## Пример взаимодействия клиента и сервера SMTP

```
                                            220 smtp.example.com ESMTP
HELO client.example.com
                                            250 Hello client.example.com
MAIL FROM:<user@example.com>
                                            250 OK
RCPT TO:<recipient@example.org>
                                            250 OK
DATA
                                            354 Start mail input; end with <CRLF>.<CRLF>
Subject: Test Email
This is a test email.
.
                                            250 OK Message accepted for delivery
QUIT
                                            221 Bye
```

