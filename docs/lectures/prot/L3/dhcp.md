# DHCP

DHCP (Dynamic Host Configuration Protocol) – протокол прикладного уровня модели OSI/ISO (стека протоколов TCP/IP), регламентирующий обмен сообщениями между клиентом (хостом), которому необходимо назначить IP-адрес в автоматическом режиме (без ручного назначения администратором сети каждому клиенту), и сервером, предоставляющим подобные настройки.

Первоначально, когда клиент только подключился к сети, при условии выставленной настройки «получить IP-адрес автоматически», он имеет неопределенный IP-адрес, т.е. 0.0.0.0. Естественно, при таком IP-адресе устройство не может функционировать в сети. Для получения IP-адреса и настроек сети устройство начинает процесс переговоров с DHCP-сервером.

## Сценарии настройки DHCP-сервера
DHCP-сервер предоставляет конфигурацию клиенту, исходя из трех возможных сценариев настройки самого сервера: 

- **Ручное назначение статических адресов** – на сервере администратором настроены пары «MAC-адрес» - «IP-адрес», регламентирующие какой IP-адрес выдать устройству с известным MAC-адресом. При данной настройке времени жизни IP нет.
- **Автоматическое назначение статических адресов»** – на сервере администратор настаивает пул IP-адресов, из которого происходит выдача адресов клиентам, записывая (запоминая) автоматически пары «MAC-адрес» - «IP-адрес», и впоследствии строго следуя записанным парам, как это выполняется в первом сценарии; 
- **Автоматическое распределение динамических адресов** – на сервере администратором настраивается пул IP-адресов, из которого происходит выдача адресов клиентам на время, заданное администратором (время аренды), по истечении которого клиенту необходимо отправить запрос на продление использования полученного IP-адреса (*DHCPREQUEST*). 

## Получение компьютером IP-адреса от DHCP-сервера

![](../../imgs/dhcp.drawio.svg)

- **Сообщение «Обнаружение DHCP»** (*DHCPDISCOVER*) – первый этап процесса получения IP-адреса устройством, предназначенный для обнаружения доступных DHCP серверов. В силу природы сообщения (найти устройство, не имея адреса устройства) адрес получателя является локальным широковещательным (сеть, в которой работает вновь появившееся устройство, неизвестна). 
- **Сообщение «Предложение DHCP»** (*DHCPOFFER*) является предложением DHCP сервера о предоставляемой конфигурации клиенту. Поскольку IP-адрес у клиента отсутствует (является неопределенным), адрес назначения данного сообщения является также широковещательным. Стоит отметить, что возможна ситуация нахождения нескольких DHCP серверов, которые предлагают клиенту свои конфигурации. 
- **Сообщение «Запрос DHCP»** (*DHCPREQUEST*) – ответ клиента на предложение DHCP сервера о принятии предложения. Поскольку возможна ситуация нескольких DHCP-серверов, данное сообщение рассылается на широковещательной основе и с включением в тело сообщения идентификатора DHCP-сервера, предложение которого было принято. 
- **Сообщение «Подтверждение DHCP»** (*DHCPACK*) – подтверждение DHCP-сервера получения запроса от клиента (DHCPREQUEST), рассылаемое широковещательно. И только по получению подтверждения клиент настраивает сетевой интерфейс в соответствии с полученными конфигурациями. 

Сочетание DHCP**D**ISCOVER, DHCP**O**FFER, DHCP**R**EQUEST, DHCP**A**CK можно запомнить как **DORA** (по первым буквам после DHCP)