# Настройка VLAN на коммутаторе  

Коммутатор – это устройство канального уровня, поэтому оно не обрабатывает логические адреса, такие как IPv4. Из-за этого коммутатору безразлично, какой трафик проходит через него, из какой сети он поступил и куда направляется.  

С одной стороны, это удешевляет устройство по сравнению с маршрутизатором, но с другой – снижает безопасность, так как в такой сети любой компьютер получает широковещательные сообщения, независимо от их источника.  

Чтобы ограничить обмен данными между устройствами в одной физической сети, используют виртуальные локальные сети (VLAN). Первоначально Ethernet-сети были устроены так, что устройства работали исключительно с физическими адресами (MAC), но для масштабирования были введены виртуальные технологии.  

На канальном уровне VLAN реализуется с помощью дополнительного тега в заголовке Ethernet-кадра.  

Важно понимать, что компьютер не добавляет тег VLAN самостоятельно. Он лишь упаковывает пакеты, начиная с самого верхнего уровня модели. Поэтому компьютер не "знает", в каком VLAN он находится, а работает только со своим IP- и MAC-адресами. Коммутатор, в свою очередь, может добавлять или проверять тег VLAN, если настроен соответствующим образом.  

### Как коммутатор работает с тегами VLAN?  

Коммутатор управляет трафиком на основе двух параметров: MAC-адресов и интерфейсов. Настройка VLAN привязывается к интерфейсам. Это значит, что коммутатор проверяет и обрабатывает кадры в зависимости от тега VLAN:  
1. **Если у кадра есть тег:**  
   - Совпадает с настроенным VLAN – кадр пересылается дальше.  
   - Не совпадает – кадр отбрасывается.  
2. **Если тега нет:**  
   - Добавляется тег VLAN, соответствующий настройке интерфейса.  

### Практическая настройка  

Рассмотрим следующую топологию (у компов заданы IP: все компы в одном VLAN имеют одну сеть, т.е. у нас 3 разные сети по 2 устройства в каждой): 

![](./vlanSwitch/Снимок%20экрана%202024-11-17%20в%204.25.29 PM.png)

*(Прямоугольники на схеме служат только для визуального оформления.)*  

Сейчас все компьютеры находятся в одной VLAN, что позволяет устройствам принимать широковещательные сообщения от всех остальных. Мы изменим настройку, чтобы разделить устройства на разные VLAN.  

1. **PC0 и Server0** оставляем в VLAN 1 (по умолчанию).  
2. Для **PC1** задаем VLAN 200:  
   ```bash
   switchport access vlan 200
   ```  
3. Для **PC2** задаем VLAN 2:  
   ```bash
   switchport access vlan 2
   ```  

Теперь, если кадр приходит с интерфейса:  
- Если у кадра уже есть тег, коммутатор проверяет его соответствие заданному VLAN.  
- Если тега нет, коммутатор добавляет тег VLAN.  

### Настройка связи между коммутаторами  

Когда два коммутатора соединяются, их интерфейсы должны передавать кадры из нескольких VLAN. Для этого интерфейсы переводятся в режим **trunk**:  
```bash
switchport mode trunk
```  
В этом режиме интерфейс принимает и передает кадры с тегами всех VLAN.  

Чтобы ограничить передачу ненужных VLAN по trunk-интерфейсу, укажем, какие VLAN разрешены:  
```bash
switchport trunk allowed vlan 1,2,200
```  

Настройка Switch0:

![](./vlanSwitch/Снимок%20экрана%202024-11-17%20в%204.28.05 PM.png)

Настройка Switch1:

![](./vlanSwitch/Снимок%20экрана%202024-11-17%20в%204.29.48 PM.png)

### Дополнительные замечания  

- **Создание VLAN:** Если VLAN еще не существует в памяти коммутатора, он создается автоматически при выполнении команды `switchport access vlan {номер}`. Можно также явно создать VLAN:  
  ```bash
  vlan {номер} 
  name vlan_name  
  exit  
  ```  
- **Режимы интерфейсов:** По умолчанию интерфейсы коммутатора находятся в режиме **auto**. В этом режиме порт может автоматически перейти в режим trunk, если интерфейс на противоположной стороне запросит это с помощью DTP-кадров.  

### Проверка  

1. **Передача данных в одном VLAN:**  
   Устройства в одном VLAN успешно обмениваются данными.  

   ![](./vlanSwitch/Снимок%20экрана%202024-11-17%20в%204.31.54 PM.png)  
   ![](./vlanSwitch/Снимок%20экрана%202024-11-17%20в%204.32.52 PM.png) 


2. **Передача данных между разными VLAN:**  
   Отправим пакет с компа из одной VLAN в другую.  

   ![](./vlanSwitch/Снимок%20экрана%202024-11-17%20в%204.33.33 PM.png)  

### Итог  

Настройка VLAN позволяет изолировать устройства в пределах одной физической сети, повышая безопасность и управляемость. Однако для взаимодействия между разными VLAN требуется устройство третьего уровня – маршрутизатор.