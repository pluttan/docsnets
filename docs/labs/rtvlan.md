# Настройка интерфейсов и сабинтерфейсов роутера  

После настройки сетей между устройствами, необходимо обеспечить их взаимодействие на сетевом уровне. Для этого добавим в топологию роутер.  

![](./rtvlan/Снимок%20экрана%202024-11-18%20в%203.12.07 PM.png)  

Изменим IP-адреса всех устройств, заменив второй октет на `169`, а последний — на `2`. Таким образом, каждое устройство окажется в своей отдельной сети:  

- **PC0**: 192.169.1.2  
- **PC1**: 192.169.200.2  
- **PC2**: 192.169.2.2  
- **Server0**: 192.168.1.2  
- **Server1**: 192.168.200.2  
- **Server2**: 192.168.2.2  

Маска подсети: 255.255.255.0  

Зададим устройствам **default gateway** (адрес шлюза по умолчанию), по которому они будут отправлять трафик, если IP-адрес назначения находится в другой сети:  

- **PC0**: 192.169.1.1  
- **PC1**: 192.169.200.1  
- **PC2**: 192.169.2.1  
- **Server0**: 192.168.1.1  
- **Server1**: 192.168.200.1  
- **Server2**: 192.168.2.1  

Обычно по этим адресам располагаются интерфейсы роутера, который направляет пакеты в нужную сеть.  

| Устройство  | IP-адрес         | VLAN   | Default Gateway   |  
|-------------|------------------|--------|-------------------|  
| **PC0**     | 192.169.1.2      | 1      | 192.169.1.1       |  
| **PC1**     | 192.169.200.2    | 200    | 192.169.200.1     |  
| **PC2**     | 192.169.2.2      | 2      | 192.169.2.1       |  
| **Server0** | 192.168.1.2      | 1      | 192.168.1.1       |  
| **Server1** | 192.168.200.2    | 200    | 192.168.200.1     |  
| **Server2** | 192.168.2.2      | 2      | 192.168.2.1       |  


---

## Настройка роутера  


Так как свичи уже настроены с прошлого урока (например, интерфейс **fa0/4** уже работает в режиме **trunk**, и смена подключенного устройства эту настройку не сбивает), нам нужно настроить только роутер.  

### Шаги настройки  

1. **Поднятие интерфейсов**  
   По умолчанию интерфейсы на роутере находятся в состоянии *shutdown*. Поднимем их командой `no shutdown`:  
   ```bash
   interface fa0/0  
   no shutdown  
   exit  
   
   interface fa0/1  
   no shutdown  
   exit  
   ``` 

2. **Создание сабинтерфейсов**  
   Сабинтерфейсы создаются на основе физического интерфейса, подключенного к **trunk-порту** свитча. Номер сабинтерфейса обычно совпадает с номером VLAN.  

   Например, для VLAN 1, 200 и 2 создаем сабинтерфейсы:  
   ```bash
   interface fa0/0.1  
   encapsulation dot1q 1  
   ip address 192.168.1.1 255.255.255.0  
   exit  

   interface fa0/0.200 
   encapsulation dot1q 200  
   ip address 192.168.200.1 255.255.255.0  
   exit  

   interface fa0/0.2  
   encapsulation dot1q 2  
   ip address 192.168.2.1 255.255.255.0  
   exit  

   interface fa0/1.1  
   encapsulation dot1q 1  
   ip address 192.169.1.1 255.255.255.0  
   exit  

   interface fa0/1.200 
   encapsulation dot1q 200  
   ip address 192.169.200.1 255.255.255.0  
   exit  

   interface fa0/1.2 
   encapsulation dot1q 2  
   ip address 192.169.2.1 255.255.255.0  
   exit  
   ```  

Пример настроек:  

![](./rtvlan/Снимок%20экрана%202024-11-18%20в%203.17.11 PM.png)  
![](./rtvlan/Снимок%20экрана%202024-11-18%20в%203.17.25 PM.png)  
![](./rtvlan/Снимок%20экрана%202024-11-18%20в%203.18.17 PM.png)  
![](./rtvlan/Снимок%20экрана%202024-11-18%20в%203.19.28 PM.png)  

На этом настройка роутера завершена.  

## Тестирование сети  

Чтобы проверить настройку, попробуем отправить пинг с **PC0** на все устройства в сети. Если пакеты успешно доходят до всех адресатов, значит, конфигурация выполнена правильно.  

![](./rtvlan/Снимок%20экрана%202024-11-18%20в%203.33.50 PM.png)  
![](./rtvlan/Снимок%20экрана%202024-11-18%20в%203.33.29 PM.png)  

### Проблема с первым пингом  

Обратите внимание: пакеты достигают цели только со второго раза. Почему?  

Когда сервер получает пакет с неизвестным IP-адресом, он не может сразу отправить ответ. Сначала он удаляет этот пакет, формирует ARP-запрос, чтобы узнать MAC-адрес устройства с указанным IP, а затем ждет ARP-ответа.  

После получения ARP-ответа сервер обновляет свою таблицу ARP и в следующий раз может отправить пакет напрямую. Именно поэтому первый пинг может не пройти, а последующие — успешны.  

> Утилита **ping** отправляет несколько пакетов подряд, чтобы компенсировать такие ситуации.
