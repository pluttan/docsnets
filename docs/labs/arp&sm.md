# ARP и лавинная рассылка свича  

## Широковещательная рассылка кадра  

Сколько существует способов разослать один кадр нескольким компьютерам? Самый очевидный — создать копии кадра для каждого MAC-адреса. Однако есть и другой способ: отправить широковещательный кадр. Такой кадр в поле **Destination** содержит адрес вида `ff:ff:ff:ff:ff:ff`.  

Все устройства в сети принимают этот кадр, но распаковывают его на уровне сетевого протокола только в том случае, если их логический адрес совпадает с указанным в кадре.  

## Лавинная рассылка кадра  

Что же такое лавинная рассылка?  

Это процесс, при котором свич отправляет кадр на все свои порты, если в его MAC-таблице нет записи о MAC-адресе, указанном в поле **Destination** кадра.  

Устройства, получившие такой кадр, проигнорируют его, если их MAC-адрес не совпадает с адресом в поле **Destination**.  

## Практика: широковещательная рассылка  

Соберем следующую топологию. Каждому компьютеру присвоим IP-адрес: 192.168.0.(1–5).  

![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.29.08 PM.png)  

Отправим один ICMP-запрос с **PC0** на **Laptop2**. Как мы знаем из [предыдущей статьи](./icmp&arp.md), **PC0** сначала создаст ARP-запрос и отправит его на широковещательный MAC-адрес.  

![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.29.23 PM.png)  
![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.29.31 PM.png)  
![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.29.52 PM.png)  

Почти все устройства проигнорировали широковещательный кадр, а только одно, чей IP-адрес совпал с указанным в кадре, начало формировать ARP-ответ.  

Проверим, действительно ли кадр широковещательный:  

![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.30.22 PM.png)  

Развернув пакет, убеждаемся, что теория совпала с практикой.  

![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.31.10 PM.png)  

Далее все идет как обычно: ARP-ответ, ICMP-запрос и ICMP-ответ. Однако ICMP-пакет уже не является широковещательным.  

![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.31.18 PM.png)  
![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.31.25 PM.png)  

Мы еще раз убедились, как работает широковещательная рассылка на канальном уровне.  

## Практика: лавинная рассылка  

Теперь заглянем в "мозги" свича. Пока по сети ходили ARP- и ICMP-пакеты, свич заполнил свою MAC-таблицу, запомнив, какие устройства подключены к каким портам. Поэтому следующий запрос от **PC0** к **Laptop2** будет обработан без лишней рассылки. Если же запрос отправить на новый компьютер, ситуация с широковещательной рассылкой повторится, так как MAC-адреса снова не будет в таблице.  

Лавинная рассылка возникает, если свич не знает, к какому порту подключено устройство с определенным MAC-адресом.  

Очистим MAC-таблицу свича командой:  
```bash
clear mac address-table
```  
Проверим, что таблица пуста:  
```bash
show mac address-table
```  

![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.33.35 PM.png)  

Успех! Теперь можно наблюдать лавинную рассылку. Отправим ICMP-запрос от **PC0** к **Laptop2**.  

![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.33.57 PM.png)  
![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.34.03 PM.png)  

Картина похожа на широковещательную рассылку, но с одним отличием: поле **Destination** в Ethernet2 уже заполнено.  

![](./arp&sm/Снимок%20экрана%202024-11-17%20в%201.34.16 PM.png)  

Устройства сразу отбрасывают кадр, не читая протоколы более высокого уровня.  